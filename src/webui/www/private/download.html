<!DOCTYPE html>
<html lang="${LANG}" class="dark">

<head>
    <meta charset="UTF-8">
    <title>QBT_TR(Add Torrent Links)QBT_TR[CONTEXT=DownloadFromURLDialog]</title>
    <link rel="stylesheet" href="css/style.css?v=${CACHEID}" type="text/css">
    <link rel="stylesheet" href="css/Window.css?v=${CACHEID}" type="text/css">
    <script src="scripts/lib/MooTools-Core-1.6.0-compat-compressed.js"></script>
    <script src="scripts/lib/MooTools-More-1.6.0-compat-compressed.js"></script>
    <script src="scripts/localpreferences.js?v=${CACHEID}"></script>
    <script src="scripts/color-scheme.js?v=${CACHEID}"></script>
    <script src="scripts/misc.js?locale=${LANG}&v=${CACHEID}"></script>
</head>

<body>
    <iframe id="download_frame" name="download_frame" class="invisible" title="" src="about:blank"></iframe>
    <div style="text-align: center;">
        <br>
        <h2 class="vcenter">QBT_TR(Add torrent links)QBT_TR[CONTEXT=DownloadFromURLDialog]</h2>
        <textarea id="urls" name="urls" rows="10" required style="width: 80%;" aria-label="QBT_TR(URLs)QBT_TR[CONTEXT=DownloadFromURLDialog]"></textarea>
        <p><i>QBT_TR(One link per line (HTTP links, Magnet links and info-hashes are supported))QBT_TR[CONTEXT=DownloadFromURLDialog]</i></p>
        <div id="submitbutton" style="margin-top: 12px; text-align: center;">
            <button type="submit" id="submitButton">QBT_TR(Download)QBT_TR[CONTEXT=DownloadFromURLDialog]</button>
        </div>
    </div>

    <script>
        "use strict";

        document.getElementById("urls").focus();

        const encodedUrls = new URI().getData("urls");
        if (encodedUrls) {
            const urls = encodedUrls.split("|").map((url) => {
                return decodeURIComponent(url);
            });

            if (urls.length)
                document.getElementById("urls").value = urls.join("\n");
        }

        $("submitButton").addEvent("click", (e) => {
            e.preventDefault();

            const urls = document.getElementById("urls").value.split("\n").map(s => s.trim()).filter(s => (s.length > 0));
            if (urls.length === 0)
                return;

            for (const url of urls)
                window.parent.qBittorrent.Client.createAddTorrentWindow("QBT_TR(Magnet link)QBT_TR[CONTEXT=DownloadFromURLDialog]", url);

            window.parent.MochaUI.closeWindow(window.parent.$("downloadPage"));
        });

        new Keyboard({
            defaultEventType: "keydown",
            events: {
                "Escape": function(event) {
                    window.parent.MochaUI.closeWindow(window.parent.$("downloadPage"));
                    event.preventDefault();
                },
                "Esc": function(event) {
                    window.parent.MochaUI.closeWindow(window.parent.$("downloadPage"));
                    event.preventDefault();
                }
            }
        }).activate();
    </script>
</body>

</html>
